<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>iPhone Sensor Test</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 16px; }
    button { font-size: 18px; padding: 12px 16px; }
    .box { margin-top: 12px; padding: 12px; border: 1px solid #ddd; border-radius: 10px; }
    .row { display:flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #f2f2f2; }
    .row:last-child { border-bottom: none; }
    .k { color: #444; }
    .v { font-variant-numeric: tabular-nums; }
    .ok { color: #0a7; font-weight: 600; }
    .bad { color: #c20; font-weight: 600; }
    small { color: #666; }
  </style>
</head>
<body>
  <h2>iPhone Sensor Test</h2>
  <p><small>Tap the button, allow permissions, then move/rotate your phone.</small></p>

  <button id="btn">Tap to Enable Motion</button>
  <div class="box">
    <div>Status: <span id="status" class="bad">Not started</span></div>
    <div><small>If values stay 0 or null, open in Safari and ensure Motion & Orientation Access is allowed.</small></div>
  </div>

  <div class="box">
    <h3>Orientation (deviceorientation)</h3>
    <div class="row"><div class="k">alpha (yaw-ish)</div><div class="v" id="alpha">—</div></div>
    <div class="row"><div class="k">beta (pitch-ish)</div><div class="v" id="beta">—</div></div>
    <div class="row"><div class="k">gamma (roll-ish)</div><div class="v" id="gamma">—</div></div>
    <div class="row"><div class="k">absolute</div><div class="v" id="absolute">—</div></div>
  </div>

  <div class="box">
    <h3>Acceleration (devicemotion)</h3>
    <div class="row"><div class="k">acc x</div><div class="v" id="ax">—</div></div>
    <div class="row"><div class="k">acc y</div><div class="v" id="ay">—</div></div>
    <div class="row"><div class="k">acc z</div><div class="v" id="az">—</div></div>
    <div class="row"><div class="k">accG x</div><div class="v" id="agx">—</div></div>
    <div class="row"><div class="k">accG y</div><div class="v" id="agy">—</div></div>
    <div class="row"><div class="k">accG z</div><div class="v" id="agz">—</div></div>
    <div class="row"><div class="k">rotRate a</div><div class="v" id="rra">—</div></div>
    <div class="row"><div class="k">rotRate b</div><div class="v" id="rrb">—</div></div>
    <div class="row"><div class="k">rotRate g</div><div class="v" id="rrg">—</div></div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const fmt = (n) => (typeof n === "number" ? n.toFixed(3) : "—");

    let started = false;

    function setStatus(ok, msg) {
      const el = $("status");
      el.textContent = msg;
      el.className = ok ? "ok" : "bad";
    }

    function startListeners() {
      if (started) return;
      started = true;

      window.addEventListener("deviceorientation", (e) => {
        $("alpha").textContent = fmt(e.alpha);
        $("beta").textContent  = fmt(e.beta);
        $("gamma").textContent = fmt(e.gamma);
        $("absolute").textContent = String(!!e.absolute);
      }, true);

      window.addEventListener("devicemotion", (e) => {
        const a = e.acceleration || {};
        const ag = e.accelerationIncludingGravity || {};
        const rr = e.rotationRate || {};

        $("ax").textContent = fmt(a.x);
        $("ay").textContent = fmt(a.y);
        $("az").textContent = fmt(a.z);

        $("agx").textContent = fmt(ag.x);
        $("agy").textContent = fmt(ag.y);
        $("agz").textContent = fmt(ag.z);

        $("rra").textContent = fmt(rr.alpha);
        $("rrb").textContent = fmt(rr.beta);
        $("rrg").textContent = fmt(rr.gamma);
      }, true);

      setStatus(true, "Running ✅ (move/rotate your phone)");
    }

    async function requestIOSPermissionIfNeeded() {
      // iOS 13+ requires permission via user gesture
      const DME = window.DeviceMotionEvent;
      const DOE = window.DeviceOrientationEvent;

      try {
        if (DME && typeof DME.requestPermission === "function") {
          const res = await DME.requestPermission();
          if (res !== "granted") throw new Error("DeviceMotion permission denied");
        }
        if (DOE && typeof DOE.requestPermission === "function") {
          const res = await DOE.requestPermission();
          if (res !== "granted") throw new Error("DeviceOrientation permission denied");
        }
        return true;
      } catch (err) {
        console.error(err);
        setStatus(false, "Permission denied ❌ (check Safari settings)");
        return false;
      }
    }

    $("btn").addEventListener("click", async () => {
      setStatus(false, "Requesting permission…");
      const ok = await requestIOSPermissionIfNeeded();
      if (ok) startListeners();
    });
  </script>
</body>
</html>